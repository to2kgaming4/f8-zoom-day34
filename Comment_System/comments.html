<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Comment System</title>
        <link rel="stylesheet" href="comments.css" />
        <link rel="stylesheet" href="../main.css" />
    </head>
    <body>
        <div id="root"></div>
        <script
            crossorigin
            src="https://unpkg.com/react@18/umd/react.development.js"
        ></script>
        <script
            crossorigin
            src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
        ></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <script type="text/babel">
            const Comments = () => {
                const [comments, setComments] = React.useState([]);
                const [name, setName] = React.useState("");
                const [email, setEmail] = React.useState("");
                const [body, setBody] = React.useState("");
                const [error, setError] = React.useState(false);
                const timeFakeList = [
                    "15 phút trước",
                    "30 phút trước",
                    "45 phút trước",
                    "1 giờ trước",
                    "2 giờ trước",
                    "3 giờ trước",
                    "1 ngày trước",
                    "2 ngày trước",
                    "1 tháng trước",
                    "2 tháng trước",
                ];

                const handleClick = (e) => {
                    e.preventDefault();
                    if (
                        name &&
                        email &&
                        body &&
                        /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)
                    ) {
                        const newComment = {
                            id: comments.length + 1,
                            postId: Math.floor(
                                Math.random() * (1000 - 100 + 1) + 100
                            ),
                            name,
                            email,
                            body,
                        };
                        setComments([newComment, ...comments]);
                        setName("");
                        setEmail("");
                        setBody("");
                        setError(false);
                    } else {
                        setError(true);
                    }
                };

                React.useState(() => {
                    fetch("https://jsonplaceholder.typicode.com/comments")
                        .then((res) => res.json())
                        .then((data) => setComments(data));
                }, []);
                return (
                    <div>
                        <form action="">
                            <input
                                type="text"
                                placeholder="Nhập tên"
                                value={name}
                                required
                                onChange={(e) => {
                                    setName(e.target.value);
                                    setError(false);
                                }}
                            />
                            <input
                                type="email"
                                placeholder="Nhập Email"
                                value={email}
                                required
                                onChange={(e) => {
                                    setEmail(e.target.value);
                                    setError(false);
                                }}
                            />
                            <textarea
                                name="message"
                                rows="4"
                                cols="50"
                                placeholder="Nhập bình luận..."
                                value={body}
                                required
                                onChange={(e) => {
                                    setBody(e.target.value);
                                    setError(false);
                                }}
                            ></textarea>

                            <button
                                type="submit"
                                onClick={(e) => handleClick(e)}
                            >
                                Bình luận
                            </button>
                        </form>

                        {error && (
                            <p
                                style={{
                                    color: "red",
                                    fontSize: 24,
                                    marginBottom: 12,
                                }}
                            >
                                Không hợp lệ
                            </p>
                        )}

                        <ul>
                            {comments.map((comment) => (
                                <li key={comment.id}>
                                    <div>
                                        <img
                                            src={`https://ui-avatars.com/api/?name=${comment.name}
            &background=random`}
                                            alt="avatar"
                                        />
                                        <div>
                                            <p>{comment.name}</p>
                                            <p>
                                                <span>
                                                    {
                                                        timeFakeList[
                                                            Number(
                                                                comment.id
                                                                    .toString()
                                                                    .at(-1)
                                                            )
                                                        ]
                                                    }
                                                </span>
                                                {comment.email}
                                            </p>
                                            <p>{comment.body}</p>
                                        </div>
                                    </div>
                                </li>
                            ))}
                        </ul>
                    </div>
                );
            };

            const Header = ({ children }) => {
                return (
                    <>
                        <nav>
                            <ul>
                                <li>
                                    <a href="../Counter_App/counter.html">
                                        Counter App
                                    </a>
                                </li>
                                <li>
                                    <a href="../Todo_List_App/todo.html">
                                        {" "}
                                        Todo List App
                                    </a>
                                </li>
                                <li>
                                    <a href="../Profile_App/profile.html">
                                        Profile App
                                    </a>
                                </li>
                                <li>
                                    <a href="../Product_List/products.html">
                                        Product List
                                    </a>
                                </li>
                                <li>
                                    <a href="../Comment_System/comments.html">
                                        Comment System
                                    </a>
                                </li>
                                <li>
                                    <a href="../Weather_App/weather.html">
                                        Weather Apps
                                    </a>
                                </li>
                            </ul>
                        </nav>
                        {children}
                    </>
                );
            };
            const root = ReactDOM.createRoot(document.getElementById("root"));
            root.render(
                <Header>
                    <Comments />
                </Header>
            );
        </script>
    </body>
</html>
